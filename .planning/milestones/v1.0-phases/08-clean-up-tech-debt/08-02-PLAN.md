---
phase: 08-clean-up-tech-debt
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/01-sync-layer-hardening/01-01-SUMMARY.md
  - .planning/phases/01-sync-layer-hardening/01-02-SUMMARY.md
  - .planning/phases/01-sync-layer-hardening/01-03-SUMMARY.md
  - .planning/phases/01-sync-layer-hardening/01-04-SUMMARY.md
  - .planning/phases/03-song-rendering/03-02-SUMMARY.md
  - .planning/phases/01-sync-layer-hardening/01-VERIFICATION.md
autonomous: true
requirements: [tech-debt]

must_haves:
  truths:
    - "Every Phase 1 SUMMARY file has requirements-completed frontmatter"
    - "03-02-SUMMARY.md has requirements-completed frontmatter"
    - "Phase 1 has a VERIFICATION.md documenting requirement satisfaction"
    - "Hibernation/deploy testing and Phase 5 manual verification items are acknowledged as deferred"
  artifacts:
    - path: ".planning/phases/01-sync-layer-hardening/01-01-SUMMARY.md"
      provides: "YAML frontmatter with requirements-completed"
      contains: "requirements-completed"
    - path: ".planning/phases/01-sync-layer-hardening/01-02-SUMMARY.md"
      provides: "YAML frontmatter with requirements-completed"
      contains: "requirements-completed"
    - path: ".planning/phases/01-sync-layer-hardening/01-03-SUMMARY.md"
      provides: "YAML frontmatter with requirements-completed"
      contains: "requirements-completed"
    - path: ".planning/phases/01-sync-layer-hardening/01-04-SUMMARY.md"
      provides: "YAML frontmatter with requirements-completed"
      contains: "requirements-completed"
    - path: ".planning/phases/03-song-rendering/03-02-SUMMARY.md"
      provides: "requirements-completed field in existing frontmatter"
      contains: "requirements-completed"
    - path: ".planning/phases/01-sync-layer-hardening/01-VERIFICATION.md"
      provides: "Post-hoc verification record for Phase 1"
      contains: "SYNC-01"
  key_links: []
---

<objective>
Fix six documentation-level tech debt items: add missing `requirements-completed` frontmatter to Phase 1 SUMMARY files and 03-02-SUMMARY.md, create a retroactive VERIFICATION.md for Phase 1, and document the two cannot-fix-with-code items (hibernation deploy testing, Phase 5 manual verification) as acknowledged deferrals.

Purpose: Bring all planning documentation to a consistent format so every phase has traceability from plans through summaries to verification.
Output: Six modified/created documentation files in `.planning/phases/`.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-clean-up-tech-debt/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add requirements-completed frontmatter to Phase 1 and Phase 3 SUMMARYs</name>
  <files>
    .planning/phases/01-sync-layer-hardening/01-01-SUMMARY.md
    .planning/phases/01-sync-layer-hardening/01-02-SUMMARY.md
    .planning/phases/01-sync-layer-hardening/01-03-SUMMARY.md
    .planning/phases/01-sync-layer-hardening/01-04-SUMMARY.md
    .planning/phases/03-song-rendering/03-02-SUMMARY.md
  </files>
  <action>
For each Phase 1 SUMMARY file, **prepend** minimal YAML frontmatter. Do NOT restructure or rewrite the existing prose content — only add the frontmatter block at the top:

`01-01-SUMMARY.md` (Protocol Redesign — laid groundwork for SYNC-01):
```yaml
---
phase: 01-sync-layer-hardening
plan: "01"
requirements-completed: []
---
```
Note: Plan 01 defined the protocol contract but did not complete any requirement on its own. Requirements were completed by subsequent plans that implemented the protocol.

`01-02-SUMMARY.md` (Server Hardening — completed SYNC-01, SYNC-03, SYNC-05):
```yaml
---
phase: 01-sync-layer-hardening
plan: "02"
requirements-completed: [SYNC-01, SYNC-03, SYNC-05]
---
```

`01-03-SUMMARY.md` (Hook Rewrite — completed SYNC-02, SYNC-04, SYNC-05):
```yaml
---
phase: 01-sync-layer-hardening
plan: "03"
requirements-completed: [SYNC-02, SYNC-04, SYNC-05]
---
```

`01-04-SUMMARY.md` (Tests — validated prior work, no new requirements):
```yaml
---
phase: 01-sync-layer-hardening
plan: "04"
requirements-completed: []
---
```

For `03-02-SUMMARY.md`, add the missing field to the **existing** YAML frontmatter block. Insert `requirements-completed: [SONG-03, SONG-04, SONG-05]` into the frontmatter. Do NOT remove or change any existing frontmatter fields.
  </action>
  <verify>
    <automated>grep -l "requirements-completed" .planning/phases/01-sync-layer-hardening/01-*-SUMMARY.md .planning/phases/03-song-rendering/03-02-SUMMARY.md | wc -l | tr -d ' '</automated>
    <manual>Output should be "5" (four Phase 1 files + one Phase 3 file)</manual>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>All four Phase 1 SUMMARY files have YAML frontmatter with requirements-completed. 03-02-SUMMARY.md has requirements-completed in its frontmatter.</done>
</task>

<task type="auto">
  <name>Task 2: Create Phase 1 VERIFICATION.md and document deferred items</name>
  <files>
    .planning/phases/01-sync-layer-hardening/01-VERIFICATION.md
  </files>
  <action>
Create `.planning/phases/01-sync-layer-hardening/01-VERIFICATION.md` as a retroactive verification record. Follow the format established by phases 2-7 (check any existing VERIFICATION.md for the pattern). Include:

1. **Header:** Phase 1: Sync Layer Hardening — Verification (retroactive)
2. **Date:** Note this is a retroactive record created during Phase 8 tech debt cleanup
3. **Requirements check:** For each of SYNC-01 through SYNC-05:
   - Status: PASS
   - Evidence: Reference the specific code artifacts and 31 server+hook tests
   - SYNC-01: Server handles all message types — `src/server/glory-server.ts` with handlers for join, set-song, browse, go-live, transfer-leader, update-setlist
   - SYNC-02: Hook exposes state without stale closures — `src/client/use-deadsync.ts` with useRef pattern, leaderDisconnected export consumed by LeaderDisconnectBanner (Phase 7)
   - SYNC-03: Storage within limits — sharded storage (meta + setlist-info + song:N keys) in `src/server/glory-server.ts`
   - SYNC-04: Wake Lock API — `src/client/lib/wake-lock.ts` utility created
   - SYNC-05: Auto-reconnect — partysocket handles reconnect, hook re-sends join on reconnect
4. **Deferred items section:** Two items that cannot be resolved by code changes:
   - "Hibernation + storage sharding not tested against actual Cloudflare deploy" — local `partykit dev` does not hibernate. Deferred to production deployment.
   - "Phase 5 has 4 human verification items pending (slide animation, pulse effect, instant snap-back, real PartyKit presence)" — these are visual/timing checks requiring two browser tabs on a running PartyKit session. Acknowledged as manual smoke test items, not blocking v1.0 functionality.
5. **Overall status:** PASS (all requirements verified by code and tests; two operational items deferred)
  </action>
  <verify>
    <automated>test -f .planning/phases/01-sync-layer-hardening/01-VERIFICATION.md && grep -c "SYNC-0" .planning/phases/01-sync-layer-hardening/01-VERIFICATION.md</automated>
    <manual>File exists and contains references to all 5 SYNC requirements. Count should be >= 5.</manual>
    <sampling_rate>run after this task commits</sampling_rate>
  </verify>
  <done>Phase 1 has a VERIFICATION.md. All SYNC-01 through SYNC-05 documented with evidence. Hibernation deploy and Phase 5 manual verification acknowledged as deferred.</done>
</task>

</tasks>

<verification>
After both tasks:
1. `grep -rl "requirements-completed" .planning/phases/01-sync-layer-hardening/` returns 4 SUMMARY files + 0 or 1 VERIFICATION file
2. `grep "requirements-completed" .planning/phases/03-song-rendering/03-02-SUMMARY.md` returns a line with SONG-03, SONG-04, SONG-05
3. `01-VERIFICATION.md` exists and references all 5 SYNC requirements
4. No source code was modified (this plan is documentation-only)
</verification>

<success_criteria>
- All Phase 1 SUMMARY files have requirements-completed in YAML frontmatter
- 03-02-SUMMARY.md has requirements-completed field added to existing frontmatter
- Phase 1 VERIFICATION.md exists with retroactive requirement verification
- Hibernation deploy and Phase 5 manual verification items documented as deferred
- No code changes, no test regressions
</success_criteria>

<output>
After completion, create `.planning/phases/08-clean-up-tech-debt/08-02-SUMMARY.md`
</output>
