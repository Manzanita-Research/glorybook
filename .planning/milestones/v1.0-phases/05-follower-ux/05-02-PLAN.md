---
phase: 05-follower-ux
plan: 02
type: execute
wave: 2
depends_on: [05-01]
files_modified:
  - src/client/components/PresenceList.tsx
  - src/client/components/SetlistDrawer.tsx
  - src/client/components/SessionScreen.tsx
  - src/client/__tests__/PresenceList.test.tsx
  - src/client/__tests__/SetlistDrawer.test.tsx
  - src/client/__tests__/SessionScreen.test.tsx
autonomous: true
requirements: [PRES-01, PRES-02]

must_haves:
  truths:
    - "Every connected musician can see who else is in the session"
    - "Presence display shows who is on the live song vs. browsing elsewhere"
    - "Leader is identifiable in the presence list"
    - "Presence list is minimal and not distracting on stage"
  artifacts:
    - path: "src/client/components/PresenceList.tsx"
      provides: "User list with status dots"
      exports: ["PresenceList"]
    - path: "src/client/__tests__/PresenceList.test.tsx"
      provides: "Tests for presence rendering and status indicators"
  key_links:
    - from: "src/client/components/SetlistDrawer.tsx"
      to: "src/client/components/PresenceList.tsx"
      via: "rendered at bottom of drawer"
      pattern: "PresenceList"
    - from: "src/client/components/SessionScreen.tsx"
      to: "src/client/components/SetlistDrawer.tsx"
      via: "passes users and leaderId props"
      pattern: "users=.*leaderId="
---

<objective>
Add presence indicators showing who is connected and whether they are live or browsing away.

Purpose: Musicians on stage need to know who is in the session and whether anyone has drifted from the live song. This is the "debuggable presence" requirement — minimal, functional, not a social feature.
Output: PresenceList component rendered inside the SetlistDrawer, showing names with colored status dots.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-follower-ux/05-RESEARCH.md
@.planning/phases/05-follower-ux/05-01-SUMMARY.md
@src/client/components/SetlistDrawer.tsx
@src/client/components/SessionScreen.tsx
@src/shared/protocol.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PresenceList component with tests</name>
  <files>
    src/client/components/PresenceList.tsx
    src/client/__tests__/PresenceList.test.tsx
  </files>
  <action>
Create `PresenceList.tsx` — a compact list of connected users with colored status dots.

**PresenceList component:**
- Props: `users: SessionUser[]`, `leaderId: string | null`
- Import `SessionUser` from `../../shared/protocol`
- Renders a container div with:
  - `px-4 py-3 border-t border-border` (sits below song list, separated by border)
  - Heading: `h4` with text "Connected" — `text-text-muted text-xs uppercase tracking-wider mb-2`
  - `ul` with `space-y-1` for user list
- Each user renders as `li` with `flex items-center gap-2 text-sm`:
  - Status dot: `span` with `w-2 h-2 rounded-full shrink-0`
    - Green (`bg-status-connected`) when `user.isLive` is true
    - Gold (`bg-accent-gold`) when `user.isLive` is false (browsing away)
  - Name: `span` with `text-text-secondary truncate` showing `user.name`
  - If `user.id === leaderId`, append small "(lead)" label: `span` with `text-text-muted text-xs ml-1`
- Dot has `role="img"` and `aria-label` of either "Live" or "Browsing" for accessibility

**Tests in PresenceList.test.tsx:**
- Renders "Connected" heading
- Renders all user names from the users array
- Shows green dot for users with isLive=true
- Shows gold dot for users with isLive=false
- Shows "(lead)" label next to the leader
- Does not show "(lead)" for non-leader users
- Handles empty users array gracefully (still shows "Connected" heading)
- Dot has correct aria-label ("Live" or "Browsing")
  </action>
  <verify>
    <automated>npx vitest run src/client/__tests__/PresenceList.test.tsx --reporter=verbose</automated>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>PresenceList component renders user names with green/gold status dots, marks the leader, all tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate PresenceList into SetlistDrawer and wire from SessionScreen</name>
  <files>
    src/client/components/SetlistDrawer.tsx
    src/client/components/SessionScreen.tsx
    src/client/__tests__/SetlistDrawer.test.tsx
    src/client/__tests__/SessionScreen.test.tsx
  </files>
  <action>
Wire PresenceList into the SetlistDrawer and pass user data from SessionScreen.

**SetlistDrawer.tsx changes:**

1. Import `PresenceList` and `SessionUser` type from protocol.
2. Add new props: `users: SessionUser[]`, `leaderId: string | null`
3. Render `<PresenceList users={users} leaderId={leaderId} />` AFTER the `<ul>` song list, inside the drawer panel div (before the closing `</div>`). It sits at the bottom of the drawer, below the scrollable song list.
4. The PresenceList should be `shrink-0` so it doesn't scroll away — it stays pinned at the bottom of the drawer. The song list `<ul>` already has `flex-1 overflow-y-auto` so it takes remaining space.

**SessionScreen.tsx changes:**

1. Pass `users` and `leaderId` to SetlistDrawer:
```jsx
<SetlistDrawer
  open={drawerOpen}
  songs={songs}
  liveIndex={liveIndex}
  users={sessionState?.users ?? []}
  leaderId={sessionState?.leaderId ?? null}
  onSelect={handleDrawerSelect}
  onClose={() => setDrawerOpen(false)}
/>
```

**SetlistDrawer.test.tsx additions:**
- Update existing tests to pass the new required `users` and `leaderId` props (empty array and null for existing tests)
- Add test: "renders PresenceList with connected users" — pass users array, verify names appear in drawer
- Add test: "shows presence status dots" — verify green dot for live user, gold for browsing

**SessionScreen.test.tsx additions:**
- Add test: "passes users to SetlistDrawer" — open drawer, verify presence names appear (use mock users from defaultMockReturn which already has Jerry and Bobby)
  </action>
  <verify>
    <automated>npx vitest run src/client/__tests__/SetlistDrawer.test.tsx src/client/__tests__/PresenceList.test.tsx src/client/__tests__/SessionScreen.test.tsx --reporter=verbose</automated>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>PresenceList renders inside SetlistDrawer showing connected users with live/browsing status dots. SetlistDrawer receives users and leaderId from SessionScreen. All existing and new tests pass.</done>
</task>

</tasks>

<verification>
- [ ] `npx vitest run` — full test suite passes
- [ ] Opening SetlistDrawer shows user names with colored dots below the song list
- [ ] Live users show green dots, browsing users show gold dots
- [ ] Leader is marked with "(lead)" label
- [ ] Presence list does not interfere with song list scrolling
- [ ] Presence list is minimal — no avatars, no activity feeds
</verification>

<success_criteria>
- PresenceList.tsx exists with status dots and leader marking
- SetlistDrawer renders PresenceList below song list
- SessionScreen passes users and leaderId to SetlistDrawer
- All existing tests still pass (SetlistDrawer tests updated with new required props)
- New tests cover presence rendering, status indicators, and integration
</success_criteria>

<output>
After completion, create `.planning/phases/05-follower-ux/05-02-SUMMARY.md`
</output>
