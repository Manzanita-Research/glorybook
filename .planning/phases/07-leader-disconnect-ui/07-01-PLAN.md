---
phase: 07-leader-disconnect-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/client/components/LeaderDisconnectBanner.tsx
  - src/client/components/SessionScreen.tsx
  - src/client/__tests__/LeaderDisconnectBanner.test.tsx
  - src/client/__tests__/SessionScreen.test.tsx
autonomous: true
requirements:
  - SYNC-02

must_haves:
  truths:
    - "When the leader disconnects, followers see 'Leader reconnecting...' text within 1 second"
    - "The indicator disappears when the leader reconnects or a new leader is promoted"
    - "The leader does not see the disconnect banner on their own screen"
    - "The leaderDisconnected export from useDeadSync is consumed by a UI component"
  artifacts:
    - path: "src/client/components/LeaderDisconnectBanner.tsx"
      provides: "Leader disconnect status banner"
      min_lines: 10
    - path: "src/client/__tests__/LeaderDisconnectBanner.test.tsx"
      provides: "Unit tests for banner component"
      min_lines: 15
  key_links:
    - from: "src/client/components/SessionScreen.tsx"
      to: "useDeadSync"
      via: "destructures leaderDisconnected from hook return"
      pattern: "leaderDisconnected"
    - from: "src/client/components/SessionScreen.tsx"
      to: "src/client/components/LeaderDisconnectBanner.tsx"
      via: "conditional render when leaderDisconnected && !isLeader"
      pattern: "leaderDisconnected.*!isLeader"
---

<objective>
Wire the existing `leaderDisconnected` hook export into a visible UI banner so followers know when the leader has dropped off. This closes the SYNC-02 gap — the hook already exposes the data, but no component reads it.

Purpose: Musicians on stage need to know the leader dropped, but not be alarmed — it resolves itself via reconnection or promotion. A calm, informational banner (gold/amber, not red) keeps them informed without disrupting the set.

Output: LeaderDisconnectBanner component, SessionScreen integration, unit and integration tests.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-leader-disconnect-ui/07-RESEARCH.md
@src/client/components/GoLiveBanner.tsx
@src/client/components/SessionScreen.tsx
@src/client/use-deadsync.ts
@src/client/__tests__/SessionScreen.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LeaderDisconnectBanner and wire into SessionScreen</name>
  <files>
    src/client/components/LeaderDisconnectBanner.tsx
    src/client/components/SessionScreen.tsx
  </files>
  <action>
Create `src/client/components/LeaderDisconnectBanner.tsx`:
- A non-interactive `<div>` (not a button — no user action to take)
- `role="status"` and `aria-live="polite"` for accessibility
- Styled with `bg-status-warning/20 text-status-warning` — gold/amber, informational, not alarming
- Text: "Leader reconnecting..." — present tense, hopeful, not scary
- `shrink-0` so it doesn't collapse in the flex column
- `py-2 text-center text-sm font-medium w-full` — slightly less prominent than GoLiveBanner since it's informational, not actionable
- Export as named export `LeaderDisconnectBanner`
- No props needed — purely informational

Modify `src/client/components/SessionScreen.tsx`:
- Add `leaderDisconnected` to the destructuring from `useDeadSync()` (it's currently omitted)
- Import `LeaderDisconnectBanner` from `./LeaderDisconnectBanner`
- Render conditionally ABOVE the GoLiveBanner, below the header:
  ```
  {leaderDisconnected && !isLeader && (
    <LeaderDisconnectBanner />
  )}
  ```
- The `!isLeader` guard prevents showing the banner to the leader (who is the one disconnected — they're offline and won't see it anyway, but this is defensive)
- Banner auto-disappears when `leaderDisconnected` becomes null (React conditional rendering)
- Both banners can stack (disconnect above GoLive) — they communicate different things
  </action>
  <verify>
    <automated>npx vitest run --reporter=verbose</automated>
    <manual>Visually confirm LeaderDisconnectBanner.tsx exists and SessionScreen imports and renders it</manual>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>LeaderDisconnectBanner component exists with gold/amber styling and accessibility attributes. SessionScreen destructures leaderDisconnected and conditionally renders the banner for followers only.</done>
</task>

<task type="auto">
  <name>Task 2: Add unit and integration tests for leader disconnect banner</name>
  <files>
    src/client/__tests__/LeaderDisconnectBanner.test.tsx
    src/client/__tests__/SessionScreen.test.tsx
  </files>
  <action>
Create `src/client/__tests__/LeaderDisconnectBanner.test.tsx`:
- Test that the banner renders "Leader reconnecting..." text
- Test that the element has `role="status"` for accessibility
- Test that the element has `aria-live="polite"` for non-intrusive screen reader announcements
- Follow existing test patterns from GoLiveBanner or other component tests (import from vitest, @testing-library/react)

Add integration tests to `src/client/__tests__/SessionScreen.test.tsx`:
- Test: shows leader disconnect banner when `leaderDisconnected` is `{ graceSeconds: 30 }` and `isLeader` is `false` — expect "Leader reconnecting..." to be in the document
- Test: does NOT show leader disconnect banner when `isLeader` is `true` (even if `leaderDisconnected` is set) — expect queryByText to return null
- Test: does NOT show leader disconnect banner when `leaderDisconnected` is `null` and `isLeader` is `false` — expect queryByText to return null
- Follow existing mock pattern in SessionScreen.test.tsx: override `mockReturnValue` with desired state before rendering
- The mock already includes `leaderDisconnected: null` — override to `{ graceSeconds: 30 }` for the positive test cases
  </action>
  <verify>
    <automated>npx vitest run src/client/__tests__/LeaderDisconnectBanner.test.tsx src/client/__tests__/SessionScreen.test.tsx --reporter=verbose</automated>
    <sampling_rate>run after this task commits</sampling_rate>
  </verify>
  <done>All new tests pass. LeaderDisconnectBanner has 3 unit tests (renders text, has status role, has polite aria-live). SessionScreen has 3 new integration tests (banner shows for follower, hidden for leader, hidden when null). Full test suite green.</done>
</task>

</tasks>

<verification>
1. `npx vitest run --reporter=verbose` — full test suite passes with no regressions
2. `leaderDisconnected` is destructured from useDeadSync in SessionScreen (no orphaned exports)
3. LeaderDisconnectBanner renders with role="status" and aria-live="polite"
4. Banner only shows when `leaderDisconnected` is truthy AND user is NOT the leader
5. Banner text is "Leader reconnecting..." — warm, informational, not alarming
</verification>

<success_criteria>
- LeaderDisconnectBanner.tsx exists and renders a gold/amber status banner
- SessionScreen conditionally renders the banner for followers when leader disconnects
- 6 new tests pass (3 unit + 3 integration)
- Full test suite green with no regressions
- SYNC-02 requirement gap closed — leaderDisconnected is no longer an orphaned export
</success_criteria>

<output>
After completion, create `.planning/phases/07-leader-disconnect-ui/07-01-SUMMARY.md`
</output>
