---
phase: 08-clean-up-tech-debt
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/client/components/ChordLine.tsx
  - src/client/__tests__/SessionScreen.test.tsx
  - src/client/lib/chord-tokenizer.ts
  - src/client/use-deadsync.ts
autonomous: true
requirements: [tech-debt]

must_haves:
  truths:
    - "tsc --noEmit exits with zero errors"
    - "All 208 tests still pass after changes"
    - "ChordLine import path is canonical (../lib/ not ../../client/lib/)"
    - "Test-only exports in chord-tokenizer.ts are documented with @internal JSDoc"
  artifacts:
    - path: "src/client/components/ChordLine.tsx"
      provides: "Canonical import path for ChordSegment"
      contains: '../lib/chord-tokenizer'
    - path: "src/client/__tests__/SessionScreen.test.tsx"
      provides: "Type-safe mock with no tsc errors"
      contains: "UseDeadSyncReturn"
    - path: "src/client/lib/chord-tokenizer.ts"
      provides: "@internal JSDoc on test-only exports"
      contains: "@internal"
    - path: "src/client/use-deadsync.ts"
      provides: "Exported UseDeadSyncReturn type for test consumers"
      contains: "export interface UseDeadSyncReturn"
  key_links:
    - from: "src/client/__tests__/SessionScreen.test.tsx"
      to: "src/client/use-deadsync.ts"
      via: "import UseDeadSyncReturn type for mock typing"
      pattern: "import.*UseDeadSyncReturn.*use-deadsync"
---

<objective>
Fix three code-level tech debt items from the v1.0 milestone audit: (1) a cosmetic import path in ChordLine.tsx, (2) three TypeScript type errors in SessionScreen.test.tsx mock objects, and (3) missing documentation on test-only exports in chord-tokenizer.ts.

Purpose: Achieve zero `tsc --noEmit` errors and clean up misleading import paths and undocumented export intent.
Output: Four modified source files, zero TypeScript errors, 208 tests passing.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-clean-up-tech-debt/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix TypeScript errors and export UseDeadSyncReturn</name>
  <files>
    src/client/use-deadsync.ts
    src/client/__tests__/SessionScreen.test.tsx
  </files>
  <action>
In `src/client/use-deadsync.ts`:
- Change `interface UseDeadSyncReturn` to `export interface UseDeadSyncReturn` (line 44). This makes the hook's return type available to test files that need to type their mocks.

In `src/client/__tests__/SessionScreen.test.tsx`:
- Add import: `import type { UseDeadSyncReturn } from "../use-deadsync";`
- Add a type annotation to the `defaultMockReturn` object: `const defaultMockReturn: UseDeadSyncReturn = { ... }`. This tells TypeScript that `leaderDisconnected` is `LeaderDisconnectedInfo | null` (not literal `null`), and `sessionState.leaderId` is `string | null` (not literal `null`), so spread-and-override in individual tests works without type errors.
- If the full type annotation requires adjusting any mock field values to match the interface, do so — but the existing values should already be correct since they match real hook behavior.
- Do NOT change test logic or assertions. Only add the type annotation.

Verify after changes: `npx tsc --noEmit` must exit 0. `npx vitest run` must show 208 tests passing.
  </action>
  <verify>
    <automated>npx tsc --noEmit && npx vitest run</automated>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>tsc --noEmit exits 0 (was 3 errors). All 208 tests pass. UseDeadSyncReturn is exported from use-deadsync.ts.</done>
</task>

<task type="auto">
  <name>Task 2: Fix ChordLine import path and document test-only exports</name>
  <files>
    src/client/components/ChordLine.tsx
    src/client/lib/chord-tokenizer.ts
  </files>
  <action>
In `src/client/components/ChordLine.tsx` (line 1):
- Change: `import type { ChordSegment } from "../../client/lib/chord-tokenizer";`
- To: `import type { ChordSegment } from "../lib/chord-tokenizer";`
- This is the canonical relative path from `src/client/components/` to `src/client/lib/`. The old path worked by going up to `src/` then back into `client/lib/` — correct but misleading.

In `src/client/lib/chord-tokenizer.ts`:
- Add JSDoc comment above `export function tokenizeLine`: `/** @internal Exported for unit testing — production code uses tokenizeChart */`
- Add JSDoc comment above `export function isAnnotation`: `/** @internal Exported for unit testing — called internally by tokenizeLine */`
- Do NOT remove the `export` keyword from either function. Tests import them directly.

Verify: `npx tsc --noEmit` still exits 0. `npx vitest run` still shows 208 passing.
  </action>
  <verify>
    <automated>npx tsc --noEmit && npx vitest run</automated>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>ChordLine.tsx uses `../lib/chord-tokenizer` import path. tokenizeLine and isAnnotation have @internal JSDoc comments. Zero regressions.</done>
</task>

</tasks>

<verification>
After both tasks:
1. `npx tsc --noEmit` exits with code 0 (zero errors)
2. `npx vitest run` shows 208 tests passing across 16 files
3. `grep -r '../../client/lib/chord-tokenizer' src/` returns nothing
4. `grep '@internal' src/client/lib/chord-tokenizer.ts` returns 2 matches
</verification>

<success_criteria>
- Zero TypeScript compiler errors (was 3)
- 208 tests passing (no regressions)
- ChordLine import path is canonical
- Test-only exports are documented
- UseDeadSyncReturn type is available for external import
</success_criteria>

<output>
After completion, create `.planning/phases/08-clean-up-tech-debt/08-01-SUMMARY.md`
</output>
