---
phase: 02-app-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
  - src/client/main.tsx
  - src/client/App.tsx
  - src/client/app.css
  - vite.config.ts
  - partykit.json
  - package.json
autonomous: true
requirements:
  - SHELL-01
  - SHELL-02

must_haves:
  truths:
    - "Running `npx vite build` produces a dist/ directory with index.html and JS bundle"
    - "Running `npx partykit dev` serves the app on localhost:1977 with no errors"
    - "The served page has a dark background (not white) using Tailwind v4 theme tokens"
    - "React 19 and Tailwind v4 are installed and functional"
  artifacts:
    - path: "index.html"
      provides: "Vite HTML entry point with viewport meta, dark class, root div"
      contains: "id=\"root\""
    - path: "src/client/main.tsx"
      provides: "React 19 createRoot bootstrap"
      contains: "createRoot"
    - path: "src/client/App.tsx"
      provides: "Root React component"
      contains: "function App"
    - path: "src/client/app.css"
      provides: "Tailwind v4 imports and @theme color tokens"
      contains: "@theme"
    - path: "vite.config.ts"
      provides: "Vite build config with React and Tailwind plugins"
      contains: "tailwindcss"
    - path: "partykit.json"
      provides: "PartyKit serve block pointing to dist/"
      contains: "singlePageApp"
  key_links:
    - from: "index.html"
      to: "src/client/main.tsx"
      via: "script tag module import"
      pattern: "src=\"/src/client/main.tsx\""
    - from: "src/client/main.tsx"
      to: "src/client/App.tsx"
      via: "import and render"
      pattern: "import.*App"
    - from: "src/client/main.tsx"
      to: "src/client/app.css"
      via: "CSS import"
      pattern: "import.*app\\.css"
    - from: "vite.config.ts"
      to: "@tailwindcss/vite"
      via: "plugin registration"
      pattern: "tailwindcss\\(\\)"
---

<objective>
Set up the Vite entry point, React 19, Tailwind v4, and PartyKit serve block so the app loads in a browser with a dark stage-friendly theme.

Purpose: This is the foundation every other Phase 2 plan builds on. Nothing renders without an entry point, a CSS framework, and a working dev server.
Output: A loadable dark-themed React app served by `npx partykit dev` on port 1977.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-app-shell/02-RESEARCH.md

@partykit.json
@package.json
@vitest.config.ts
@src/client/use-deadsync.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and upgrade React 19 + Tailwind v4</name>
  <files>package.json</files>
  <action>
Run the following install commands:

```bash
npm install react@^19 react-dom@^19 partysocket@^1.1 tailwindcss@^4.1 @tailwindcss/vite@^4.1
npm install -D @types/react@^19 @types/react-dom@^19
```

After install, verify no React 18 remnants: `npm ls react` should show 19.x. Run `npx vitest run` to check existing tests still pass (the hook tests use React Testing Library and should work with React 19).

If type errors appear in existing code due to React 19 changes (e.g., `forwardRef`, `ReactNode`), fix them. The hook uses basic React APIs so this should be clean.

Note: partysocket upgrade from 1.0.1 to 1.1.x — semver minor, API is stable. Tests will catch any breakage.
  </action>
  <verify>
    <automated>cd /Users/jem/code/manzanita-research/glorybook && npm ls react | grep "19\." && npm ls tailwindcss | grep "4\." && npx vitest run</automated>
    <manual>package.json shows react@^19, tailwindcss@^4.1, partysocket@^1.1</manual>
  </verify>
  <done>React 19, Tailwind v4, and partysocket 1.1.x are installed. Existing tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Create Vite entry point, Tailwind theme, and PartyKit serve config</name>
  <files>index.html, src/client/main.tsx, src/client/App.tsx, src/client/app.css, vite.config.ts, partykit.json</files>
  <action>
Create 5 new files and update 1 existing file:

**1. `vite.config.ts`** — Create (separate from vitest.config.ts):
```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import tailwindcss from "@tailwindcss/vite";

export default defineConfig({
  plugins: [react(), tailwindcss()],
  build: {
    outDir: "dist",
  },
});
```

**2. `index.html`** (project root) — Vite HTML entry:
```html
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Glory</title>
</head>
<body class="bg-surface text-text-primary min-h-dvh">
  <div id="root"></div>
  <script type="module" src="/src/client/main.tsx"></script>
</body>
</html>
```

Key details: `class="dark"` on html (always dark, no light mode). `viewport-fit=cover` for iPad Safe Area. `min-h-dvh` uses dynamic viewport height (handles iOS Safari toolbar).

**3. `src/client/app.css`** — Tailwind v4 CSS-first config with both theme variants:
```css
@import "tailwindcss";

@custom-variant dark (&:where(.dark, .dark *));

@theme {
  /* Warm-dark surface colors */
  --color-surface: #1a1410;
  --color-surface-raised: #241e18;
  --color-surface-overlay: #2e2620;

  /* Text colors */
  --color-text-primary: #f5f0e8;
  --color-text-secondary: #a89e8c;
  --color-text-muted: #6b6155;

  /* Accent colors — chord highlighting palette used app-wide */
  --color-accent-gold: #d4a843;
  --color-accent-blue: #5b8fb9;
  --color-accent-purple: #9b72b0;

  /* Interactive — gold as primary action color */
  --color-interactive: #d4a843;
  --color-interactive-hover: #e0b94f;
  --color-interactive-active: #c49a3a;

  /* Status */
  --color-status-connected: #5a9a5a;
  --color-status-disconnected: #c45a4a;
  --color-status-warning: #d4a843;

  /* Border */
  --color-border: #3a3228;
  --color-border-focus: #d4a843;
}

/* OLED theme override — true black backgrounds */
.oled {
  --color-surface: #000000;
  --color-surface-raised: #0a0a0a;
  --color-surface-overlay: #141414;
  --color-border: #1a1a1a;
}

/* Safe area padding for iPad */
.safe-area-padding {
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
  padding-bottom: env(safe-area-inset-bottom);
}
```

**4. `src/client/main.tsx`** — React 19 entry:
```tsx
import { createRoot } from "react-dom/client";
import { App } from "./App";
import "./app.css";

createRoot(document.getElementById("root")!).render(<App />);
```

**5. `src/client/App.tsx`** — Minimal root component (placeholder for Phase 2 Plan 02):
```tsx
export function App() {
  return (
    <div className="min-h-dvh bg-surface text-text-primary safe-area-padding flex items-center justify-center">
      <div className="text-center">
        <h1 className="text-4xl font-bold text-accent-gold tracking-tight">Glory</h1>
        <p className="mt-2 text-text-secondary text-lg">soar.</p>
      </div>
    </div>
  );
}
```

This is a minimal placeholder showing the branding. Plan 02 replaces the content with the join screen.

**6. Update `partykit.json`** — Add serve block:
```json
{
  "$schema": "https://www.partykit.io/schema.json",
  "name": "deadsync",
  "main": "src/server/deadsync-server.ts",
  "port": 1977,
  "compatibilityDate": "2026-02-24",
  "serve": {
    "path": "dist",
    "build": "npx vite build",
    "singlePageApp": true
  }
}
```

After creating all files, run `npx vite build` to verify the build succeeds and produces `dist/index.html`.
  </action>
  <verify>
    <automated>cd /Users/jem/code/manzanita-research/glorybook && npx vite build && test -f dist/index.html && npx vitest run</automated>
    <manual>Run `npx partykit dev` and visit http://localhost:1977 — should see "Glory" with "soar." on a dark warm-brown background</manual>
  </verify>
  <done>Vite builds successfully. index.html, main.tsx, App.tsx, app.css, vite.config.ts all exist. partykit.json has serve block. The app displays "Glory" and "soar." on a dark background when served.</done>
</task>

</tasks>

<verification>
1. `npx vite build` completes without errors
2. `dist/index.html` exists after build
3. `npx vitest run` — existing tests still pass
4. `npx partykit dev` serves the app on http://localhost:1977
5. The page has a dark background (not white)
6. "Glory" and "soar." are visible
7. No console errors in browser
</verification>

<success_criteria>
- Vite build succeeds with React 19 + Tailwind v4
- PartyKit dev serves the built app
- Dark warm-brown theme is visible (not default white)
- All existing tests pass after React 19 upgrade
</success_criteria>

<output>
After completion, create `.planning/phases/02-app-shell/02-01-SUMMARY.md`
</output>
