---
phase: 05-follower-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/client/app.css
  - src/client/components/GoLiveBanner.tsx
  - src/client/components/SessionScreen.tsx
  - src/client/components/ChordChart.tsx
  - src/client/__tests__/GoLiveBanner.test.tsx
  - src/client/__tests__/SessionScreen.test.tsx
autonomous: true
requirements: [FOLL-01, FOLL-02, FOLL-03, FOLL-04]

must_haves:
  truths:
    - "Follower who has not browsed away sees the new song automatically when the leader advances"
    - "Follower browsing a different song sees a gold GO LIVE banner at the top of the screen"
    - "Tapping GO LIVE instantly snaps the follower back to the leader's current song"
    - "Gold border appears around the screen when follower is browsing away from live song"
    - "Border and banner briefly pulse when the leader advances while follower is browsing"
    - "Auto-follow song changes show a slide-left transition animation"
    - "Go Live snap-back is instant with no animation"
  artifacts:
    - path: "src/client/components/GoLiveBanner.tsx"
      provides: "GO LIVE banner component"
      exports: ["GoLiveBanner"]
    - path: "src/client/app.css"
      provides: "Slide-in and pulse keyframe animations"
      contains: "@keyframes slide-in-left"
    - path: "src/client/__tests__/GoLiveBanner.test.tsx"
      provides: "Tests for GoLiveBanner rendering and click behavior"
  key_links:
    - from: "src/client/components/SessionScreen.tsx"
      to: "src/client/components/GoLiveBanner.tsx"
      via: "conditional render when !isLive && !isLeader"
      pattern: "!isLive.*GoLiveBanner"
    - from: "src/client/components/GoLiveBanner.tsx"
      to: "useDeadSync actions.goLive"
      via: "onClick handler"
      pattern: "onGoLive"
---

<objective>
Build the follower browse-away experience: GO LIVE banner, gold screen border, pulse effects, and slide-left song transition animation.

Purpose: Followers need clear visual feedback when they've drifted from the live song, a one-tap way back, and smooth transitions when auto-following the leader.
Output: GoLiveBanner component, CSS keyframes for animations, updated SessionScreen and ChordChart with browse-away visuals.
</objective>

<execution_context>
@/Users/jem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-follower-ux/05-RESEARCH.md
@src/client/components/SessionScreen.tsx
@src/client/components/ChordChart.tsx
@src/client/use-deadsync.ts
@src/client/app.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GoLiveBanner component and CSS keyframes</name>
  <files>
    src/client/components/GoLiveBanner.tsx
    src/client/app.css
    src/client/__tests__/GoLiveBanner.test.tsx
  </files>
  <action>
Create `GoLiveBanner.tsx` — a fixed banner at the top of the screen that appears when a follower browses away from the live song.

**GoLiveBanner component:**
- Props: `onGoLive: () => void` and `pulse?: boolean`
- Renders a button element (full-width, gold background)
- Text: just "GO LIVE" — bold, uppercase, centered, white/dark text on gold (`bg-accent-gold`)
- `shrink-0` so it doesn't collapse in the flex column
- `py-3` height, `tracking-wider text-sm font-bold uppercase`
- When `pulse` is true, add `animate-pulse-once` class
- `aria-label="Go live — return to current song"`
- onClick calls `onGoLive`

**CSS keyframes in app.css** — add after the existing `.safe-area-padding` rule:

```css
/* Song transition: slide in from right */
@keyframes slide-in-left {
  from {
    transform: translateX(30%);
    opacity: 0.3;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* Border pulse when leader advances while browsing */
@keyframes ring-pulse {
  0%, 100% { box-shadow: inset 0 0 0 4px var(--color-accent-gold); }
  50% { box-shadow: inset 0 0 0 6px var(--color-accent-gold); }
}

/* Banner text pulse when leader advances while browsing */
@keyframes pulse-once {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}
```

**Tests in GoLiveBanner.test.tsx:**
- Renders "GO LIVE" text
- Calls onGoLive callback when clicked
- Has accessible aria-label
- Applies pulse-once animation class when pulse prop is true
- Does not apply pulse class when pulse is false
  </action>
  <verify>
    <automated>npx vitest run src/client/__tests__/GoLiveBanner.test.tsx --reporter=verbose</automated>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>GoLiveBanner component renders gold banner with "GO LIVE" text, calls callback on tap, tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate browse-away visuals and slide animation into SessionScreen</name>
  <files>
    src/client/components/SessionScreen.tsx
    src/client/components/ChordChart.tsx
    src/client/__tests__/SessionScreen.test.tsx
  </files>
  <action>
Wire GoLiveBanner, browse-away border, pulse detection, and slide-left animation into the existing components.

**SessionScreen.tsx changes:**

1. Import GoLiveBanner component.

2. Add pulse detection state — track when `liveIndex` changes while `!isLive`:
```typescript
const [pulse, setPulse] = useState(false);
const prevLiveIndexRef = useRef(liveIndex);

useEffect(() => {
  if (liveIndex !== prevLiveIndexRef.current) {
    if (!isLive) {
      setPulse(true);
      const timer = setTimeout(() => setPulse(false), 600);
      prevLiveIndexRef.current = liveIndex;
      return () => clearTimeout(timer);
    }
    prevLiveIndexRef.current = liveIndex;
  }
}, [liveIndex, isLive]);
```

3. Add gold border to root div when follower is browsing away. On the existing `h-dvh bg-surface...` div, add conditional classes:
   - When `!isLive && !isLeader`: add `ring-4 ring-inset ring-accent-gold`
   - When `pulse` is also true: add `animate-[ring-pulse_0.6s_ease-in-out]`
   The `ring` utilities don't affect layout (unlike border), so flex layout stays intact.

4. Render GoLiveBanner INSIDE the flex column, between the session info header and the chord chart area. Only when `!isLive && !isLeader`:
```jsx
{!isLive && !isLeader && (
  <GoLiveBanner onGoLive={actions.goLive} pulse={pulse} />
)}
```
This pushes the chord chart down (not fixed positioning) so no content is hidden.

5. Pass `isLive` and `currentSong?.id` (for animation key) down to ChordChart — add optional `animateTransition` prop.

**ChordChart.tsx changes:**

1. Add optional `animateTransition?: boolean` prop.
2. Wrap the scrollable chart body div in a keyed wrapper that triggers slide-in animation ONLY during auto-follow:
```jsx
<div
  key={animateTransition ? `song-${song.id}` : undefined}
  className={`flex-1 overflow-y-auto px-4 py-4 font-mono text-xl ${
    animateTransition ? 'animate-[slide-in-left_200ms_ease-out]' : ''
  }`}
>
```
When `animateTransition` is false (Go Live snap-back, initial render), no key change and no animation.

In SessionScreen, pass `animateTransition={isLive}` to ChordChart. This means:
- Auto-follow (isLive=true): song change triggers slide animation via key change
- Go Live snap-back: isLive just became true from goLive action, but the song id changes at the same moment so animation would play. To prevent this, track a `justSnappedBack` ref that is set to true when goLive fires and cleared after one render cycle. Pass `animateTransition={isLive && !justSnappedBack.current}`.

Add a wrapper around the goLive call:
```typescript
function handleGoLive() {
  justSnappedBackRef.current = true;
  actions.goLive();
  // Clear on next frame so subsequent auto-follows animate
  requestAnimationFrame(() => { justSnappedBackRef.current = false; });
}
```

Also: per CONTEXT.md, if a follower browses to the song that IS the live song, the hook's `browse()` already auto-detects and sets `isLive=true`. The border/banner will disappear because they're conditioned on `!isLive`. No extra logic needed.

**SessionScreen.test.tsx additions:**

Add tests after the existing TransferMenu tests:

- "shows GoLiveBanner when follower is browsing away" — set `mockReturnValue` with `isLive: false, isLeader: false`, assert "GO LIVE" text is present
- "does not show GoLiveBanner when follower is live" — `isLive: true`, assert "GO LIVE" not present
- "does not show GoLiveBanner for leader" — `isLeader: true, isLive: false`, assert "GO LIVE" not present
- "shows gold ring when follower is browsing away" — `isLive: false, isLeader: false`, check root div has `ring-accent-gold` class
- "does not show gold ring when live" — `isLive: true`, check root div does NOT have `ring-accent-gold`
  </action>
  <verify>
    <automated>npx vitest run src/client/__tests__/SessionScreen.test.tsx src/client/__tests__/GoLiveBanner.test.tsx --reporter=verbose</automated>
    <sampling_rate>run after this task commits, before next task begins</sampling_rate>
  </verify>
  <done>GoLiveBanner appears when follower browses away, gold ring-4 border shows around screen, slide-left animation plays on auto-follow song changes, Go Live snap-back is instant with no animation. All tests pass.</done>
</task>

</tasks>

<verification>
- [ ] `npx vitest run` — full test suite passes
- [ ] GoLiveBanner renders only for followers who browsed away (!isLive && !isLeader)
- [ ] Tapping GO LIVE calls actions.goLive() and banner disappears
- [ ] Gold ring border appears around screen when browsing away
- [ ] Ring and banner pulse briefly when leader advances while follower is browsing
- [ ] ChordChart shows slide-left animation on auto-follow song changes
- [ ] Go Live snap-back is instant (no slide animation)
- [ ] Browsing to the live song auto-clears browse state (banner/border disappear)
</verification>

<success_criteria>
- GoLiveBanner.tsx exists with correct styling and behavior
- CSS keyframes added for slide-in-left, ring-pulse, pulse-once
- SessionScreen conditionally renders GoLiveBanner and gold ring border
- ChordChart animates song transitions only during auto-follow
- All existing tests still pass
- New tests cover banner visibility, ring visibility, and click behavior
</success_criteria>

<output>
After completion, create `.planning/phases/05-follower-ux/05-01-SUMMARY.md`
</output>
